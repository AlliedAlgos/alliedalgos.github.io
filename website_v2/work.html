<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Robot Simulation IDE</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .console {
      font-family: monospace;
      background: #0d1117;
      color: #d1d5db;
      padding: 10px;
      height: 200px;
      overflow-y: auto;
      border-radius: 0.5rem;
    }
    .run-button {
      background-color: #22c55e;
      color: white;
      padding: 6px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: 0.2s;
    }
    .run-button:hover { background-color: #16a34a; }
    .robot {
      width: 30px;
      height: 30px;
      background: #38bdf8;
      border-radius: 50%;
      position: absolute;
      transition: transform 0.5s ease;
    }
    .field {
      background: #1e293b;
      position: relative;
      width: 100%;
      height: 300px;
      border-radius: 10px;
      overflow: hidden;
    }
  </style>
</head>
<body class="bg-[#0d1117] text-gray-200 min-h-screen flex flex-col items-center p-6">
  <h1 class="text-3xl font-bold mb-4 text-cyan-400">Robot Simulation IDE</h1>

  <div class="flex gap-6 w-full max-w-6xl">
    <!-- Editor -->
    <div class="flex-1 flex flex-col gap-4">
      <textarea id="codeEditor" class="bg-[#1e1e2f] text-gray-100 w-full h-64 p-4 rounded-lg outline-none resize-none"
        placeholder="Enter your commands here... (e.g. forward, turn_left)">
forward
forward
turn_left
forward
      </textarea>

      <div class="flex gap-3 items-center">
        <button class="run-button" onclick="runSimulation()">▶ Run</button>
        <button class="bg-gray-700 px-4 py-2 rounded-lg hover:bg-gray-600" onclick="resetSimulation()">⟲ Reset</button>

        <label class="flex items-center gap-2 ml-4">
          <span>Start:</span>
          <select id="startSelect" class="bg-gray-800 px-2 py-1 rounded">
            <option>Left</option>
            <option>Right</option>
          </select>
        </label>
      </div>

      <div class="console mt-4" id="consoleOutput">Console output...</div>
    </div>

    <!-- Simulation Field -->
    <div class="w-1/2 flex flex-col gap-3">
      <div class="field" id="field">
        <div class="robot" id="robot"></div>
      </div>
    </div>
  </div>

  <script>
    const consoleOutput = document.getElementById('consoleOutput');
    const robot = document.getElementById('robot');
    const field = document.getElementById('field');
    const startSelect = document.getElementById('startSelect');

    let position = { x: 50, y: 250, angle: 0 };
    let isRunning = false;

    // Map of available commands
    const commandMap = {
      forward: async () => move(0, -50),
      backward: async () => move(0, 50),
      left: async () => move(-50, 0),
      right: async () => move(50, 0),
      turn_left: async () => rotate(-90),
      turn_right: async () => rotate(90),
    };

    function logToConsole(message) {
      consoleOutput.innerHTML += `<div>${message}</div>`;
      consoleOutput.scrollTop = consoleOutput.scrollHeight;
    }

    function resetSimulation() {
      isRunning = false;
      consoleOutput.innerHTML = 'Console cleared...';
      const start = startSelect.value;

      position = start === 'Left'
        ? { x: 50, y: 250, angle: 0 }
        : { x: field.clientWidth - 100, y: 250, angle: 0 };

      updateRobotPosition();
      logToConsole('Simulation reset.');
    }

    function updateRobotPosition() {
      robot.style.transform = `translate(${position.x}px, ${position.y}px) rotate(${position.angle}deg)`;
    }

    async function move(dx, dy) {
      position.x += dx;
      position.y += dy;
      updateRobotPosition();
      logToConsole(`Moved to (${position.x}, ${position.y})`);
      await new Promise(res => setTimeout(res, 600));
    }

    async function rotate(deg) {
      position.angle += deg;
      updateRobotPosition();
      logToConsole(`Rotated to ${position.angle}°`);
      await new Promise(res => setTimeout(res, 500));
    }

    async function runSimulation() {
      if (isRunning) return;
      isRunning = true;

      logToConsole('--- Simulation Started ---');
      const code = document.getElementById('codeEditor').value.trim().split('\n').map(c => c.trim()).filter(Boolean);

      for (const line of code) {
        if (!isRunning) break;

        const cmd = commandMap[line.toLowerCase()];
        if (cmd) {
          logToConsole(`Executing: ${line}`);
          await cmd();
        } else {
          logToConsole(`⚠ Unknown command: ${line}`);
        }
      }

      logToConsole('--- Simulation Complete ---');
      isRunning = false;
    }

    resetSimulation();
  </script>
</body>
</html>
