<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Allied Work Documentation</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

<style>
    body {
        font-family: ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
    }
    body.dark {
        background-color: #070707; /* Dark background */
        color: #f5f5f5; /* Light text */
    }
    body.light {
        background-color: #f5f5f5; /* Light background */
        color: #1f1f1f; /* Dark text */
    }
    .prose h3 {
        margin-top: 2rem;
        padding-bottom: 0.5rem;
        border-bottom: 1px solid #444;
    }
    code {
        background-color: #1f1f1f;
        color: #f87171;
        padding: 0.125rem 0.25rem;
        border-radius: 0.25rem;
    }
    body.light code {
        background-color: #e2e2e2;
        color: #b91c1c;
    }
    aside::-webkit-scrollbar {
        width: 8px;
    }
    aside::-webkit-scrollbar-thumb {
        background-color: #444;
        border-radius: 4px;
    }
    body.light aside::-webkit-scrollbar-thumb {
        background-color: #aaa;
    }
    footer {
        transition: background-color 0.3s, color 0.3s;
    }
    body.dark footer {
        background-color: #070707;
        color: #f5f5f5;
    }
    body.light footer {
        background-color: #f5f5f5;
        color: #1f1f1f;
    }
</style>

<script>
    $(function () {
        $("#navbar").load("../layout/navbar.html");
        $("#footer").load("../layout/footer.html");
    });
</script>
</head>

<body class="dark mt-32">

<!-- Navbar -->
<div id="navbar" class="w-full"></div>

<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex relative">

        <!-- Sidebar -->
        <aside class="sticky top-28 hidden lg:block w-64 pt-28 pr-8 shrink-0 overflow-y-auto h-[calc(100vh-4rem)]">
            <!-- Search Input -->
            <div class="px-2 pb-4">
                <input type="text" id="search-input" placeholder="Search documentation..."
                       class="w-full px-3 py-2 text-sm border border-gray-700 rounded-lg bg-[#111] text-white focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-150 ease-in-out">
            </div>

            <!-- Dark/Light Mode Toggle -->
            <div class="px-2 pb-6">
                <button id="mode-toggle"
                        class="w-full py-2 px-3 rounded-md bg-blue-600 text-white hover:bg-blue-700 transition">
                    Light Mode
                </button>
            </div>

            <nav class="space-y-6" id="sidebar-nav">
                <div>
                    <h3 class="text-xs font-semibold text-gray-500 uppercase tracking-wider px-2">Topics</h3>
                    <div class="mt-3 space-y-2 px-2" id="nav-links-container"></div>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="min-w-0 w-full lg:w-[calc(100%-16rem)] pt-10 pb-12 lg:pr-10">
            <div class="max-w-none prose prose-lg" id="main-content-container">

                <h1 class="text-4xl font-extrabold tracking-tight mb-6">
                    Allied Work Documentation
                </h1>
                <p class="mt-4 text-xl text-gray-400">
                    Use this documentation to understand the various projects and components under the Allied Work umbrella, from the coding editor to the AutoCorrection function.
                </p>

                <div id="dynamic-content-area" class="mt-12"></div>

                <div class="mt-20 pt-8 border-t border-gray-800 text-sm text-gray-400 flex justify-between">
                    <div class="flex space-x-4">
                        <a href="#" id="prev-link" class="hover:text-white font-medium transition duration-150 ease-in-out hidden">&leftarrow; Previous</a>
                        <a href="#" id="next-link" class="hover:text-white font-medium transition duration-150 ease-in-out hidden">Next &rightarrow;</a>
                    </div>
                    <p class="text-right">Was this page helpful?</p>
                </div>

            </div>
        </main>

    </div>
</div>

<!-- Footer -->
<div id="footer" class="w-full"></div>

<!-- Content and Sidebar JS -->
<script>
    const pageContent = {
        'what-is-it': {
            title: 'Allied Work',
            paragraphs: [
                `Allied Work allows users to see where their robots will go on the game mat with the built-in visualizer. This is very helpful because many times teams are using trial and error to reach their desired location on the game mat. Not only can teams do this, but they can also code with ease. The Allied Workspace allows users to code in its native language called Allied Work. Allied Work is made to be simple so everybody can code their robot. When you are done coding your path, you can press the run button to see the path of the robot, then copy the Python code from the built-in Python generator.`,
            ],
        },
        'AlliedAutoCorrectionBlocks': {
            title: 'Allied AutoCorrection Blocks',
            paragraphs: [
                `Allied AutoCorrection is a beautiful and helpful function for all FLL teams. The function provides precision while running code. Imagine you are walking straight and you trip. Now you will get back in the same line you were walking in, and walk until you reach your final destination. Allied AutoCorrection is here to help the robot do the same. One of the sensors used is the gyro sensor. A gyro sensor helps track the robot's pitch, yaw, and roll. The code essentially checks if the robot’s current yaw or heading is within a range of 5 degrees from the target. If it isn’t, it checks whether the current heading is greater or less than the target. If it is greater, the robot turns left until it is within the 5-degree range. If it is less, the robot turns right until it reaches that range.
The code can be modified to run faster; however, increasing the speed often requires a larger acceptable range, while a smaller range typically demands more time.`,
            ],
        },
        'related': {
            title: 'How they are related',
            paragraphs: [
                `You may be asking how an autocorrection software and an auto correction function are related. Well, in the Allied Work editor whenever you code a command for movement such as \`drive\`, it takes the Allied AutoCorrection function and uses it to give accurate movements.`,
            ],
        },
        'AACWork': {
            title: 'How Does Allied AutoCorrection Work?',
            paragraphs: [
                `Allied AutoCorrection works by continuously monitoring the robot's orientation and position using sensors, primarily the gyro sensor. If the robot deviates from its intended path or heading, the system automatically calculates the necessary corrections and adjusts the motor outputs to bring the robot back on track. This real-time feedback loop ensures that the robot maintains precision throughout its movement commands, compensating for external disturbances or inherent mechanical inaccuracies. This makes the robot's movements much more reliable and repeatable in a competitive environment.`,
                `Beyond the gyro sensor, Allied AutoCorrection can integrate data from other sensors like encoders on wheels to measure distance traveled, or even color sensors to detect lines on the game mat. By combining these sensor inputs, the system creates a more comprehensive understanding of the robot's state and environment. This multi-sensor fusion allows for more accurate deviation detection and more precise corrective actions.`,
                `The core of the auto-correction mechanism involves a PID (Proportional-Integral-Derivative) controller, or a similar control loop. This controller takes the error (the difference between the desired state and the actual state) and calculates an output to minimize that error. For instance, if the robot drifts slightly to the left, the controller would slightly increase the power to the right motor and decrease power to the left motor until the robot is back on its intended heading. The tuning of these control parameters is crucial for smooth and stable correction.`,
            ],
        },
        'benefits': {
            title: 'Benefits & Impact',
            paragraphs: [
                `The combination of Allied Work's intuitive coding environment and Allied AutoCorrection's precision offers significant benefits to FLL teams. Firstly, it drastically reduces the learning curve for new team members, enabling them to contribute to robot programming much faster. The visualizer provides immediate feedback, transforming abstract code into tangible robot movements, which is invaluable for debugging and understanding complex paths.`,
                `Secondly, and perhaps most critically, Allied AutoCorrection empowers teams to achieve higher scores in competitions. By ensuring consistent and accurate robot movements, it minimizes errors that often lead to missed mission objectives. This increased reliability allows teams to focus on refining their strategies and attempting more challenging tasks, rather than constantly troubleshooting basic movement issues. Ultimately, Allied Work fosters a more efficient, engaging, and successful robotics experience for students.`,
            ],
        },
        'additional': {
            title: 'Additional Considerations',
            paragraphs: [
                `When implementing complex robot movements, integrating features like Allied AutoCorrection is crucial for consistent performance. Without it, minor errors can accumulate, leading to significant deviations from the desired path. The visualizer in Allied Work provides an immediate feedback loop for developers, allowing them to quickly identify and rectify any issues before deploying code to the physical robot. This significantly reduces the time spent on trial and error and improves overall development efficiency. Consider incorporating odometry for even greater accuracy.`,
            ],
        },
        'future-enhancements': {
            title: 'Future Enhancements',
            paragraphs: [
                `Future enhancements for Allied Work could include more advanced path planning algorithms, integration with vision systems for object recognition and avoidance, and machine learning capabilities to optimize movement patterns over time. Imagine a robot that learns from its past runs and automatically refines its auto-correction parameters for even greater precision. These advancements would push the boundaries of what FLL teams can achieve with their robots.`,
            ],
        },
        'community': {
            title: 'Community and Support',
            paragraphs: [
                `Building a strong community around Allied Work is essential. Providing forums, tutorials, and examples would empower users to get the most out of the platform. Sharing best practices for implementing Allied AutoCorrection in different scenarios could further enhance its utility. A dedicated support channel would ensure that teams receive timely assistance with any challenges they encounter, fostering a collaborative environment for innovation in robotics education.`,
            ],
        },
    };

    const contentKeys = Object.keys(pageContent);

    function renderContent() {
        const navContainer = document.getElementById('nav-links-container');
        const contentArea = document.getElementById('dynamic-content-area');
        navContainer.innerHTML = '';
        contentArea.innerHTML = '';

        contentKeys.forEach((key, index) => {
            const section = pageContent[key];

            // Sidebar link
            const navLink = document.createElement('a');
            navLink.href = `#${key}`;
            navLink.className = `block text-sm transition duration-150 ease-in-out p-1 rounded-md ${index === 0 ? 'bg-blue-600 text-white font-bold' : 'text-gray-400 hover:text-white hover:bg-gray-800'}`;
            navLink.textContent = section.title;
            navLink.onclick = (e) => {
                e.preventDefault();
                document.getElementById('search-input').value = '';
                filterContent('');
                document.querySelectorAll('#nav-links-container a').forEach(a => {
                    a.className = a.className.replace('bg-blue-600 text-white font-bold', 'text-gray-400 hover:text-white hover:bg-gray-800');
                });
                navLink.className = 'bg-blue-600 text-white font-bold';
                document.getElementById(key).scrollIntoView({ behavior: 'smooth' });
                updateNav(key);
            };
            navContainer.appendChild(navLink);

            // Main content
            const contentSection = document.createElement('section');
            contentSection.id = key;
            contentSection.className = 'mb-12';
            const titleElement = document.createElement('h2');
            titleElement.className = 'mt-10 pt-2 text-2xl font-semibold text-white';
            titleElement.textContent = section.title;
            contentSection.appendChild(titleElement);
            section.paragraphs.forEach(pText => {
                const pElement = document.createElement('p');
                pElement.className = 'mt-4 text-gray-300';
                pElement.innerHTML = pText.replace(/`([^`]+)`/g, (match, code) =>
                    `<code>${code}</code>`
                );
                contentSection.appendChild(pElement);
            });
            contentArea.appendChild(contentSection);
        });

        document.getElementById('search-input').addEventListener('input', e => filterContent(e.target.value));
        const initialKey = window.location.hash.substring(1) || contentKeys[0];
        updateActiveLink(initialKey);

        window.addEventListener('hashchange', () => {
            document.getElementById('search-input').value = '';
            filterContent('');
            updateActiveLink(window.location.hash.substring(1));
        });
    }

    function filterContent(searchTerm) {
        const lowerCaseSearchTerm = searchTerm.toLowerCase().trim();
        const contentSections = document.querySelectorAll('#dynamic-content-area > section');
        const navLinks = document.querySelectorAll('#nav-links-container a');
        let hasResults = false;
        const contentContainer = document.getElementById('main-content-container');
        let noResultsMessage = document.getElementById('no-results-message');

        contentSections.forEach(section => {
            const title = section.querySelector('h2').textContent.toLowerCase();
            const paragraphs = Array.from(section.querySelectorAll('p')).map(p => p.textContent.toLowerCase()).join(' ');
            const isMatch = title.includes(lowerCaseSearchTerm) || paragraphs.includes(lowerCaseSearchTerm);
            const navLink = Array.from(navLinks).find(link => link.href.endsWith(`#${section.id}`));

            if (lowerCaseSearchTerm === '') {
                section.style.display = 'block';
                if (navLink) navLink.style.display = 'block';
                hasResults = true;
            } else if (isMatch) {
                section.style.display = 'block';
                if (navLink) navLink.style.display = 'block';
                hasResults = true;
            } else {
                section.style.display = 'none';
                if (navLink) navLink.style.display = 'none';
            }
        });

        if (!hasResults && lowerCaseSearchTerm !== '') {
            if (!noResultsMessage) {
                const message = document.createElement('p');
                message.id = 'no-results-message';
                message.className = 'text-center text-xl text-gray-500 mt-20 p-8 border border-dashed border-gray-700 rounded-xl';
                message.textContent = `Sorry, no results found for "${searchTerm}". Try a different term!`;
                contentContainer.appendChild(message);
            }
            document.getElementById('prev-link').classList.add('hidden');
            document.getElementById('next-link').classList.add('hidden');
        } else if (noResultsMessage) {
            noResultsMessage.remove();
            const activeKey = window.location.hash.substring(1) || contentKeys[0];
            updateNav(activeKey);
        }
    }

    function updateActiveLink(activeKey) {
        document.querySelectorAll('#nav-links-container a').forEach(a => {
            if (a.style.display !== 'none' && a.href.includes(activeKey)) {
                a.className = 'bg-blue-600 text-white font-bold';
            } else {
                a.className = 'text-gray-400 hover:text-white hover:bg-gray-800 rounded-md p-1 text-sm';
            }
        });
        updateNav(activeKey);
    }

    function updateNav(activeKey) {
        const searchInput = document.getElementById('search-input');
        if (searchInput.value.trim() !== '') {
            document.getElementById('prev-link').classList.add('hidden');
            document.getElementById('next-link').classList.add('hidden');
            return;
        }
        const index = contentKeys.indexOf(activeKey);
        const prevLink = document.getElementById('prev-link');
        const nextLink = document.getElementById('next-link');
        prevLink.classList.add('hidden');
        nextLink.classList.add('hidden');
        if (index > 0) {
            const prevKey = contentKeys[index - 1];
            prevLink.href = `#${prevKey}`;
            prevLink.textContent = `← ${pageContent[prevKey].title}`;
            prevLink.classList.remove('hidden');
        }
        if (index < contentKeys.length - 1) {
            const nextKey = contentKeys[index + 1];
            nextLink.href = `#${nextKey}`;
            nextLink.textContent = `${pageContent[nextKey].title} →`;
            nextLink.classList.remove('hidden');
        }
    }

    document.addEventListener('DOMContentLoaded', renderContent);

    // Dark/Light Mode Toggle
    const body = document.body;
    const toggle = document.getElementById('mode-toggle');
    if(localStorage.getItem('theme') === 'light'){
        body.classList.remove('dark'); body.classList.add('light'); toggle.textContent = 'Dark Mode';
    } else {
        body.classList.remove('light'); body.classList.add('dark'); toggle.textContent = 'Light Mode';
    }
    toggle.addEventListener('click', () => {
        if(body.classList.contains('dark')){
            body.classList.remove('dark'); body.classList.add('light'); toggle.textContent = 'Dark Mode';
        } else {
            body.classList.remove('light'); body.classList.add('dark'); toggle.textContent = 'Light Mode';
        }
        localStorage.setItem('theme', body.classList.contains('dark') ? 'dark' : 'light');
    });
</script>

</body>
</html>
